<template name="studyMandarinCard">

  <div class="modal fade" id="helpModal" tabindex="-1"
    role="dialog" aria-labelledby="helpModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">
            <span aria-hidden="true">&times;</span>
            <span class="sr-only">Close</span>
          </button>
          <h4 class="modal-title" id="helpModalLabel"
          >Mandarin cloze deletion exercise help</h4>
        </div>
        <div class="modal-body">
          <p>Complete the sentence(s) by filling in the missing words.
          Press <kbd>escape</kbd> if you do not know the word or if you
          do not remember it.</p>
          <p>Remember to configure your keyboard options such that you can
            input Chinese characters.</p>
          <p>Dictionary definitions can be selected by clicking on a word.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default"
            data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  {{#with card}}
  <div class="container" style="width: 800px; padding-top: 2em;">
    {{#each sentences}}
      <div class="mandarin-sentence row">

        {{! Chinese text on the left side. Main focus is here }}
        <div class="mandarin-task col-xs-8">
          {{#each blocks}}
            <div class="mandarin-block">
              <div class="mandarin-pinyin">
                {{#if showPinyin ../..}}
                  {{selectedPinyin}}
                  &nbsp; {{! FIXME. selectedPinyin can be empty }}
                {{else}}
                  &nbsp;
                {{/if}}
              </div>
              <div class="mandarin-chinese">
                {{#if isGap}}
                  {{#if isActive}}
                    {{#autofocus}}
                      <input
                        type="text"
                        data-placement="top"
                        data-content="{{chinese}} {{selectedPinyin}}"

                        placeholder="{{chinese}}"
                        class="mandarin-input autofocus"
                        style="width: {{len}}em;"/>
                      {{/autofocus}}
                  {{else}}
                    <input
                      disabled
                      placeholder="{{chinese}}"
                      class="mandarin-input" style="width: {{len}}em;"/>
                  {{/if}}
                {{else}}
                  {{#if isEscaped}}
                    {{text}}
                  {{else}}
                    <div class="dropdown">
                    <span class="dropdown-toggle"
                            id="dropdownMenu{{chinese}}"
                            data-toggle="dropdown" href="#">
                      {{chinese}}
                    </span>
                    <ul class="dropdown-menu mandarin-dict" role="menu"
                        aria-labelledby="dropdownMenu{{chinese}}">
                      {{#each key_value definitions}}
                        <li>{{value.pinyin}}
                          {{#each key_value value.english}}
                            <li>
                              <a class="mandarin-dict-select"
                                 data-sentence-id="{{../../sentenceId}}"
                                 data-block-id="{{../../blockId}}"
                                 data-pinyin-idx="{{ ../key }}"
                                 data-english-idx="{{ key }}"
                                 href="#">
                                {{value}}
                              </a>
                            </li>
                          {{/each}}
                        </li>
                      {{/each}}
                    </ul>
                    </div>
                  {{/if}}
                {{/if}}
              </div>
              <div class="mandarin-literal">
                {{#if literal}}
                {{literal}}
                {{else}}
                  &nbsp;
                {{/if}}
              </div>
            </div>
          {{/each}}
        </div>

        {{! English translation on the right hand side. }}
        <div class="mandarin-translation col-xs-4">
          {{english}}
        </div>
      </div>
    {{/each}}
    
  </div>
  {{/with}}
</template>
